[tox]
envlist =
    py{27,3},
    lint,
    check,
skipsdist = true
skip_missing_interpreters = true
minversion = 2.9.1
requires =
    pip >= 7.0

[pytest]
flake8-max-line-length = 100
flake8-ignore = E123 E126 E226 E402 W503 F812
addopts =
    --cov --cov-append --cov-report=term
    --doctest-modules
    --ignore=frontend/ --ignore=module.py
    --instafail
    --timeout=100
    --flake8

[testenv]
deps =
    -rrequirements.txt
    -cconstraints.txt
    -rrequirements-test.txt
passenv =
    PYTHONPATH
setenv =
    PYTHONUNBUFFERED=1
    CFLAGS = -DXMLSEC_NO_SIZE_T
    UNITTEST = true
    WEBTEST_INTERACTIVE = false
    LD_LIBRARY_PATH = {toxinidir}/../../../../build/lib
    PATH = {toxinidir}/../../../../build/bin:$PATH
commands =
    pytest {posargs}


[pycodestyle]
max-line-length = 100
ignore = E123, E126, E226, E402, W503, E741
exclude = .tox, venv, frontend, .vscode
statistics = True

[pylint]
# To allow for similarity/code duplication detection
jobs = 1
dirs = . controllers plugins services tests

[testenv:lint]
deps =
    {[testenv]deps}
    pycodestyle==2.5.0
    pylint==1.9.5; python_version<'3'
    pylint==2.3.1; python_version>='3'
commands =
    pycodestyle {posargs:.}
    pylint -rn --rcfile=.pylintrc --jobs={[pylint]jobs} {posargs:{[pylint]dirs}}

[testenv:check]
deps = 
    six==1.11.0
commands =
    python ci/check_grafana_uids.py frontend/src/app ../../../../monitoring/grafana/dashboards
